# TextPin 2.0 - 智能贴卡工具

<div align="center">

**轻量级 Windows 桌面剪贴板贴卡工具 - 让文字随处可见**

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![PyQt6](https://img.shields.io/badge/PyQt6-6.7.0-green.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)
![Version](https://img.shields.io/badge/version-2.0.2-brightgreen.svg)

[快速开始](#-快速开始) • [功能特性](#-核心功能) • [使用指南](#-使用指南) • [打包分发](#-打包分发) • [项目结构](#-项目结构)

</div>

---

## 📑 目录

- [产品概述](#-产品概述)
- [核心功能](#-核心功能)
- [快速开始](#-快速开始)
- [使用指南](#-使用指南)
- [快捷键列表](#️-快捷键列表)
- [项目结构](#️-项目结构)
- [打包分发](#-打包分发)
- [配置说明](#-配置说明)
- [常见问题](#-常见问题)
- [版本规划](#-版本规划)

---

## 💡 产品概述

### 什么是 TextPin？

TextPin 是一款**极简高效**的剪贴板贴卡工具，专为需要频繁处理文字的用户设计。通过悬浮贴卡的形式，让用户可以在任何应用上方快速查看、编辑和管理剪贴板文字内容。

### 核心价值

- 📌 **一键贴卡** - F4 快捷键瞬间创建悬浮文字卡片
- 🎯 **智能过滤** - 自动识别并过滤贴卡内部复制操作
- 📝 **随处编辑** - 贴卡内容可自由编辑、复制、搜索
- 🎨 **自由定制** - 位置、大小、透明度、字体完全可控
- 💾 **历史记录** - 自动保存剪贴板历史，随时调用
- 🧰 **自定义规则** - 创建文本处理规则，一键执行

### 产品特色

- 📌 **贴卡模式** - 多贴卡系统，不是传统的单窗口编辑器
- 🎯 **智能过滤** - 自动识别并过滤贴卡内部复制
- 💾 **历史为先** - F4 始终从历史记录读取，可靠性高
- 🎨 **实时配置** - 所有设置立即应用，无需重启
- ⚡ **快捷键系统** - 全局 + 功能 + 自定义规则快捷键

---

## ✨ 核心功能

### 🎯 贴卡管理
- ✅ **全局快捷键** - F4（可自定义）一键创建贴卡
- ✅ **智能定位** - 贴卡自动出现在鼠标位置附近
- ✅ **自动高度** - 根据内容自动调整贴卡高度
- ✅ **多贴卡支持** - 同时创建多个贴卡，自动偏移避免重叠
- ✅ **拖动调整** - 自由拖动位置，任意调整大小
- ✅ **透明度控制** - 可调整贴卡透明度，不遮挡视线

### 📋 剪贴板监听
- ✅ **自动监听** - 自动捕获剪贴板文字并保存到历史
- ✅ **智能过滤** - 忽略贴卡内部复制操作，避免重复记录
- ✅ **实时同步** - 历史记录实时更新显示
- ✅ **去重保存** - 自动过滤重复内容

### 📝 文本编辑
- ✅ **完整编辑器** - 支持复制、粘贴、剪切、全选
- ✅ **查找替换** - 统一的查找替换对话框，支持正则表达式
- ✅ **右键菜单** - 快速访问常用操作
- ✅ **一键复制** - 点击按钮复制全部内容
- ✅ **文本统计** - 显示字符数、单词数、行数
- ✅ **清除功能** - 清空内容、清除格式、清除空行
- ✅ **JSON格式化** - 一键格式化JSON文本

### 🧰 自定义规则（新功能）
- ✅ **规则编辑器** - 可视化创建文本处理规则
- ✅ **7种处理步骤**：查找替换、正则替换、移除空行、大小写转换、去除空格、添加前缀/后缀
- ✅ **实时测试** - 测试区域即时预览处理结果
- ✅ **快捷键支持** - 为每个规则设置快捷键
- ✅ **启用/禁用** - 灵活控制规则是否出现在菜单中
- ✅ **步骤管理** - 添加、编辑、删除、排序处理步骤

### 🎨 外观定制
- ✅ **尺寸设置** - 自定义默认宽度和高度
- ✅ **字体设置** - 自定义字体大小和颜色
- ✅ **背景颜色** - 自定义贴卡背景色
- ✅ **透明度** - 调整贴卡透明度
- ✅ **实时预览** - 设置立即应用到现有贴卡

### 💾 历史管理
- ✅ **自动保存** - 剪贴板内容自动保存到历史
- ✅ **实时更新** - 设置窗口实时显示最新历史
- ✅ **快速加载** - 双击历史记录创建贴卡
- ✅ **批量管理** - 可删除单条或清空全部历史

---

## 🚀 快速开始

### 环境要求
- **操作系统**：Windows 10 或更高版本
- **Python**：3.10 或更高版本
- **依赖包**：PyQt6 >= 6.7.0, pyperclip >= 1.8.2

### 安装步骤

#### 1. 克隆项目
```bash
git clone https://github.com/yourusername/textpin.git
cd textpin
```

#### 2. 安装依赖
```bash
pip install -r requirements.txt
```

或手动安装：
```bash
pip install PyQt6>=6.7.0 pyperclip>=1.8.2
```

#### 3. 运行应用
```bash
python main.py
```

### 首次运行

1. 程序启动后会自动显示**设置窗口**
2. 系统托盘出现 **TextPin 图标**
3. 默认快捷键为 **F4**

### 快速测试

1. 在任意应用中复制一段文字（Ctrl+C）
2. 按 **F4** 键
3. 贴卡自动出现在鼠标位置！

### 常见问题

**Q: 提示缺少依赖？**
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

**Q: F4 快捷键没反应？**
- 可能被其他程序占用，在设置中更换快捷键
- 以管理员身份运行程序

**Q: 如何退出程序？**
- 右键系统托盘图标 → 退出

---

## 📖 使用指南

### 基本操作

#### 1. 创建贴卡

**方法一：使用快捷键（推荐）**
1. 在任意应用中复制文字（Ctrl+C）
2. 按 **F4** 键
3. 贴卡自动出现在鼠标位置

**方法二：从历史记录**
1. 点击托盘图标打开设置窗口
2. 切换到"历史记录"标签
3. 双击任意历史记录创建贴卡

#### 2. 编辑贴卡

**基本编辑**
- 直接在贴卡中编辑文字
- `Ctrl+C` - 复制选中文字
- `Ctrl+V` - 粘贴文字
- `Ctrl+X` - 剪切选中文字
- `Ctrl+A` - 全选
- 点击"复制"按钮 - 复制全部内容

**查找替换**
- `Ctrl+F` - 打开查找对话框
- `Ctrl+H` - 打开替换对话框
- 支持：区分大小写、全词匹配、正则表达式

**右键菜单**
- 复制、粘贴、剪切、全选
- 查找、替换
- 关闭贴卡

#### 3. 调整贴卡

**移动贴卡**
- 鼠标拖动贴卡上边缘（20px 区域）
- 使用 `Ctrl+P` 可固定位置，禁止拖动

**调整大小**
- 拖动贴卡四周边缘和四个角
- 或在设置中配置默认尺寸
- 使用 `Ctrl+P` 可固定尺寸，禁止调整

**置顶控制**
- 新贴卡默认置顶（可在设置中修改）
- 使用 `Ctrl+T` 切换置顶状态
- 或右键菜单选择“窗口置顶”

**关闭贴卡**
- 点击右上角 ❌ 按钮
- 或按 `Ctrl+W` / `Alt+F4`

#### 4. 配置设置

**打开设置**
- 点击系统托盘图标
- 或右键贴卡 → 设置（计划中）

**常规设置**
- **自动监听剪贴板** - 是否自动保存剪贴板内容到历史
- **忽略自身复制** - 是否过滤贴卡内部的复制操作
- **最大历史数量** - 保存的历史记录上限
- **创建贴卡快捷键** - 自定义全局快捷键

**贴卡设置**
- **默认宽度/高度** - 新贴卡的初始尺寸
- **自动高度** - 根据内容自动调整高度
- **透明度** - 贴卡透明度（50-100%）
- **默认置顶** - 新创建的贴卡是否默认置顶 (新)
- **字体大小** - 文字字号（8-24pt）
- **字体颜色** - 文字颜色
- **背景颜色** - 贴卡背景色

**历史记录**
- 查看所有剪贴板历史
- 搜索历史内容
- 双击创建贴卡
- 删除单条或清空全部

---

## ⌨️ 快捷键列表

### 全局快捷键
| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `F4` | 创建贴卡 | 可在设置中自定义 |

### 贴卡内快捷键
| 快捷键 | 功能 |
|--------|------|
| `Ctrl+C` | 复制选中文字 |
| `Ctrl+V` | 粘贴 |
| `Ctrl+X` | 剪切 |
| `Ctrl+A` | 全选 |
| `Ctrl+F` | 查找 |
| `Ctrl+H` | 替换 |
| `Ctrl+N` | 清空内容 |
| `Ctrl+P` | 切换固定位置 (新) |
| `Ctrl+T` | 切换窗口置顶 (新) |
| `Ctrl+W` | 关闭贴卡 |
| `Alt+F4` | 关闭贴卡 |

---

## 📦 打包分发

### 快速打包（5分钟）

TextPin 提供完整的自动化打包系统，可以生成：
- **绿色版**（免安装）：解压即用
- **安装程序**：专业的 Windows 安装体验

#### 步骤 1: 安装打包依赖

```bash
pip install -r build_tools/requirements_build.txt
```

#### 步骤 2: 一键打包

**Windows 用户（推荐）**：
```bash
cd build_tools
build.bat
```

**所有平台**：
```bash
cd build_tools
python build_installer.py
```

### 打包输出

```
textPin/
├── dist/TextPin/TextPin.exe          # 绿色版可执行文件
└── installer/TextPin_Setup_v2.0.0.exe  # 安装程序
```

### 分发方式

#### 方式 1: 绿色版（免安装）
- 打包 `dist/TextPin/` 目录为 ZIP
- 用户解压后直接运行 `TextPin.exe`
- 无需安装，可放在U盘使用

#### 方式 2: 安装程序
- 分发 `installer/TextPin_Setup_v2.0.0.exe`
- 用户可自定义安装路径和数据存储位置
- 自动创建快捷方式，支持卸载

### 自定义配置

**修改版本信息**：编辑 `build_tools/version_info.txt`  
**修改应用信息**：编辑 `build_tools/build_installer.py`  
**自定义图标**：替换 `resources/icon.ico`

### 清理打包文件

```bash
cd build_tools
clean.bat
```

### 详细文档

查看 `docs/` 目录获取完整打包文档：
- `BUILD_QUICK_START.md` - 5分钟快速开始
- `PACKAGING.md` - 完整打包文档
- `BUILDING_README.md` - 打包系统说明

---

## 🗂️ 项目结构

```
textpin/
├── main.py                      # 应用入口
├── requirements.txt             # Python依赖包列表
├── .gitignore                   # Git忽略文件配置
├── LICENSE                      # MIT开源协议
├── README.md                    # 项目说明文档（本文件）
├── PRD.md                       # 产品需求文档
├── CHANGELOG.md                 # 版本更新日志
│
├── config.json                  # 配置文件（运行时自动生成）
├── textpin.db                   # SQLite数据库（运行时自动生成）
│
├── core/                        # 核心业务模块
│   ├── __init__.py              # 模块导出
│   ├── app_manager.py           # 应用管理器（协调中心）
│   ├── clipboard_monitor.py     # 剪贴板监听器
│   ├── hotkey_manager.py        # 全局快捷键管理器
│   └── storage.py               # 数据存储管理器（SQLite）
│
├── ui/                          # 用户界面模块
│   ├── __init__.py              # 模块导出
│   ├── card_window.py           # 贴卡窗口（核心UI）
│   ├── settings_window.py       # 设置窗口
│   ├── hotkey_edit.py           # 快捷键编辑控件
│   └── find_replace_dialog.py   # 查找替换对话框
│
└── utils/                       # 工具模块
    ├── __init__.py              # 模块导出
    └── config.py                # 配置管理器（JSON）
```

### 📄 核心文件说明

#### 根目录文件

| 文件 | 说明 |
|------|------|
| `main.py` | 应用程序入口，初始化 QApplication 和 AppManager |
| `requirements.txt` | Python 依赖包列表（PyQt6, pyperclip） |
| `.gitignore` | Git 版本控制忽略规则 |
| `LICENSE` | MIT 开源许可证 |
| `README.md` | 项目使用文档和说明 |
| `PRD.md` | 产品需求文档，包含功能设计和技术架构 |
| `CHANGELOG.md` | 版本更新历史和功能变更记录 |

#### 运行时生成文件

| 文件 | 说明 |
|------|------|
| `config.json` | 用户配置文件，保存所有设置项 |
| `textpin.db` | SQLite 数据库，存储剪贴板历史记录 |

#### core/ 核心模块

| 文件 | 说明 | 主要功能 |
|------|------|---------|
| `app_manager.py` | 应用管理器 | 协调所有组件，管理贴卡生命周期，处理信号通信 |
| `clipboard_monitor.py` | 剪贴板监听器 | 监听系统剪贴板变化，智能过滤内部复制，保存历史 |
| `hotkey_manager.py` | 快捷键管理器 | 注册/注销全局快捷键，处理 Windows API 消息 |
| `storage.py` | 数据存储管理器 | SQLite 数据库操作，历史记录增删查改 |

#### ui/ 界面模块

| 文件 | 说明 | 主要功能 |
|------|------|---------|
| `card_window.py` | 贴卡窗口 | 悬浮文本卡片，支持编辑、拖动、调整大小、查找替换 |
| `settings_window.py` | 设置窗口 | 5个标签页：常规、贴卡、快捷键、历史记录、关于 |
| `hotkey_edit.py` | 快捷键编辑控件 | 自定义快捷键输入控件，支持修饰键组合 |
| `find_replace_dialog.py` | 查找替换对话框 | 统一的查找替换界面，支持正则表达式 |

#### utils/ 工具模块

| 文件 | 说明 | 主要功能 |
|------|------|---------|
| `config.py` | 配置管理器 | JSON 配置文件读写，默认值管理，配置验证 |

---

## 🔧 配置说明

配置文件 `config.json` 在首次运行时自动创建，所有设置可在设置窗口中修改：

```json
{
    "clipboard": {
        "auto_monitor": true,      // 自动监听剪贴板
        "ignore_self": true,       // 忽略贴卡内部复制
        "max_history": 50          // 最大历史记录数
    },
    "card": {
        "default_width": 300,      // 贴卡默认宽度
        "default_height": 200,     // 贴卡默认高度
        "auto_height": false,      // 自动调整高度
        "opacity": 0.95,           // 透明度（0.5-1.0）
        "font_size": 10,           // 字体大小
        "font_color": "#000000",   // 字体颜色
        "bg_color": "#FFFFFF"      // 背景颜色
    },
    "hotkey": {
        "create_card": "F4"        // 创建贴卡快捷键
    },
    "settings_window": {
        "x": 100,                  // 设置窗口位置
        "y": 100,
        "width": 600,
        "height": 500
    }
}
```

---

## 💾 数据存储

应用使用SQLite数据库存储历史记录，数据库文件为 `textpin.db`。

### 数据表结构

**clipboard_history** - 剪贴板历史表
- `id` - 主键
- `content` - 文本内容
- `content_hash` - 内容哈希（用于去重）
- `timestamp` - 时间戳
- `is_favorite` - 是否收藏
- `char_count` - 字符数
- `word_count` - 单词数

**app_settings** - 应用设置表
- `key` - 设置键
- `value` - 设置值

---

## 🐛 故障排除

### 问题：F4 快捷键不响应
**可能原因**：
- 快捷键被其他程序占用
- 需要管理员权限

**解决方案**：
1. 在设置中更换其他快捷键
2. 以管理员身份运行程序
3. 检查其他程序的快捷键冲突

### 问题：历史记录不更新
**可能原因**：
- 关闭了"自动监听剪贴板"
- 开启了"忽略自身复制"且在贴卡内复制

**解决方案**：
1. 确保在设置中勾选了"自动监听剪贴板"
2. 检查"忽略自身复制"设置
3. 重启应用程序

### 问题：贴卡位置不对
**解决方案**：
- 贴卡会在鼠标位置附近创建（偏移 1px）
- 多个贴卡会自动错开（每个偏移 25px）
- 可以拖动贴卡到任意位置

### 问题：数据库错误
**可能原因**：
- 数据库文件损坏
- 磁盘空间不足

**解决方案**：
1. 备份 `textpin.db` 文件
2. 删除数据库文件，重新启动程序
3. 检查磁盘空间

---

## 📝 版本历史与规划

### v2.0.0（当前版本）✅

**核心功能**
- [x] 悬浮贴卡窗口系统
- [x] 全局快捷键（F4 创建贴卡）
- [x] 剪贴板自动监听与历史记录
- [x] 智能过滤贴卡内部复制
- [x] 自动高度调整
- [x] 贴卡拖动和调整大小
- [x] 查找替换功能
- [x] 实时配置应用
- [x] 系统托盘支持

**数据管理**
- [x] SQLite 数据存储
- [x] 历史记录去重
- [x] 实时历史更新
- [x] 配置文件管理

### v2.1.0（下一版本）🚧

**UI/UX 改进**
- [ ] 深色主题支持
- [ ] 贴卡模板系统（预设配色方案）
- [ ] 贴卡右键菜单增强
- [ ] 动画效果（淡入淡出）
- [ ] 贴卡吸附功能

**功能增强**
- [ ] 贴卡分组管理
- [ ] 贴卡标签/分类
- [ ] 快速笔记功能
- [ ] 文本处理工具（大小写、去空格等）
- [ ] 历史记录收藏功能

### v3.0.0（长期计划）🔮

**高级功能**
- [ ] 多显示器支持优化
- [ ] 贴卡导出为图片
- [ ] Markdown 渲染支持
- [ ] 代码高亮显示
- [ ] OCR 图片识别（可选）

**跨平台**
- [ ] macOS 版本
- [ ] Linux 版本
- [ ] 云同步功能

**扩展性**
- [ ] 插件系统
- [ ] API 接口
- [ ] 自定义脚本支持

---

## 🤝 贡献

欢迎提交Issue和Pull Request！

---

## 📄 许可证

MIT License

---

## 👨‍💻 作者

TextPin Development Team

---

## 🙏 致谢

- PyQt6 - 强大的GUI框架
- SQLite - 轻量级数据库
- Python 社区的所有贡献者

---

**享受使用 TextPin！如有问题或建议，欢迎反馈。**
